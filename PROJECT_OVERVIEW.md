# PBK CRM Unified System

## Описание проекта

Единая CRM система PBK Construction с полной интеграцией всех компонентов бизнеса.

**Домен:** crm.pbkconstruction.net

## Компоненты системы

### 1. **Основная CRM**
- Управление лидами и клиентами
- Воронки продаж (настраиваемые)
- Дашборд с метриками
- Карточки клиентов и лидов

### 2. **Интеграция Retell AI (Звонки)**
- Просмотр всех звонков через Retell AI
- Создание заявок на звонки
- Подтверждение звонков (workflow)
- Расшифровка звонков
- Перевод расшифровок
- Дополнительные инструкции для каждого звонка
- Настройка системных промптов и базы знаний

### 3. **Telegram Bot (Fixly Bot)**
- Управление звонками через Telegram
- Создание и подтверждение звонков
- Получение уведомлений
- Интеграция с Copilot CLI для управления CRM

### 4. **Корпоративная почта**
- Отправка и получение писем в CRM
- Интеграция с карточками клиентов

### 5. **OpenAI интеграция**
- Генерация коммерческих предложений
- Просчет через API OpenAI
- Автоматическое формирование по шаблону

### 6. **Сайт PBK**
- Интеграция основного сайта
- Единая точка входа

### 7. **Copilot CLI Agent**
- Специализированный AI-ассистент для управления CRM
- Ограничен доступом только к этой директории
- Управление через Telegram
- Выполнение задач автоматизации

## Структура директорий

```
pbk-crm-unified/
├── frontend/              # Next.js фронтенд
│   ├── app/
│   │   ├── dashboard/    # Дашборд
│   │   ├── leads/        # Лиды
│   │   ├── clients/      # Клиенты
│   │   ├── calls/        # Звонки Retell
│   │   ├── pipelines/    # Воронки продаж
│   │   ├── email/        # Почта
│   │   ├── settings/     # Настройки
│   │   └── api/          # API routes
│   ├── components/
│   └── public/
├── backend/               # Node.js/Express бэкенд
│   ├── api/
│   ├── services/
│   │   ├── retell/       # Retell AI интеграция
│   │   ├── openai/       # OpenAI интеграция
│   │   ├── email/        # Email сервис
│   │   └── telegram/     # Telegram bot
│   ├── database/
│   └── middleware/
├── copilot-agent/         # Специализированный Copilot
│   ├── system-prompt.md
│   ├── telegram-bot.js
│   └── config/
├── config/                # Конфигурация
│   ├── credentials.json
│   ├── settings.json
│   └── retell-config.json
├── database/              # База данных
│   ├── schema.sql
│   └── migrations/
├── scripts/               # Утилиты
└── docs/                  # Документация
```

## Основные функции

### Управление звонками

1. **Создание заявки на звонок:**
   - Пользователь с правами создает заявку
   - Указывает номер, клиента, дополнительные инструкции
   
2. **Подтверждение звонка:**
   - Другой пользователь с правами подтверждает
   - После подтверждения звонок выполняется через Retell AI

3. **Просмотр звонков:**
   - Все звонки видны на странице /calls
   - Расшифровка каждого звонка
   - Перевод расшифровки
   - История в карточке клиента/лида

### Воронки продаж

- Описание воронки своими словами
- Автоматическое создание в CRM
- Настройка правил для каждого статуса
- Множественные воронки
- Ручное редактирование

### Настройки

- **Retell AI:** API ключи, системный промпт, база знаний
- **OpenAI:** API ключи, шаблоны
- **Email:** SMTP настройки, корпоративная почта
- **Telegram:** Bot token, разрешения
- **Copilot Agent:** Системный промпт, ограничения доступа
- **Пользователи:** Права доступа, роли

## Технологический стек

- **Frontend:** Next.js 14, TypeScript, Tailwind CSS
- **Backend:** Node.js, Express, TypeScript
- **Database:** PostgreSQL
- **Real-time:** Socket.io (для обновлений)
- **AI:** Retell AI, OpenAI GPT-4
- **Messaging:** Telegram Bot API
- **Email:** Nodemailer
- **Deployment:** Docker, Cloudflare Tunnel

## Безопасность

- Все креды в зашифрованном хранилище
- Настройка в интерфейсе Settings
- Разделение прав доступа
- Аудит всех действий

## Доступ

- **URL:** https://crm.pbkconstruction.net
- **Telegram Bot:** @pbk_fixly_bot
- **Copilot Agent:** Доступ только к /root/pbk-crm-unified/

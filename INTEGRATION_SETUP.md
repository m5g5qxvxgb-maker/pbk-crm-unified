# PBK CRM - Unified Integration System

## ğŸ“‹ ĞĞ±Ğ·Ğ¾Ñ€

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ° ĞµĞ´Ğ¸Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ğ´Ğ»Ñ PBK CRM, Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ÑÑÑ‰Ğ°Ñ Ğ²ÑĞµ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:
- **Fixly.pl** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°ÑĞ²ĞºĞ¸ Ğ½Ğ° Ñ€ĞµĞ¼Ğ¾Ğ½Ñ‚
- **Offerteo.pl** - ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ñ‹
- **Retell AI** - Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ñ‹Ğµ Ğ·Ğ²Ğ¾Ğ½ĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· AI
- **Telegram Bot** - ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Unified Integration Manager                â”‚
â”‚            (Docker: pbk-integrations)                   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Telegram â”‚  â”‚  Fixly   â”‚  â”‚ Offerteo â”‚  â”‚ Retell  â”‚â”‚
â”‚  â”‚   Bot    â”‚  â”‚ Webhook  â”‚  â”‚ Webhook  â”‚  â”‚   AI    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚             â”‚              â”‚             â”‚     â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚  PBK CRM    â”‚
                    â”‚  Backend    â”‚
                    â”‚  (REST API) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ PostgreSQL  â”‚
                    â”‚  Database   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

### ĞĞ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

```
/root/pbk-crm-unified/
â”œâ”€â”€ backend/src/
â”‚   â”œâ”€â”€ integrations/
â”‚   â”‚   â””â”€â”€ unified-integration-manager.js  # Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ webhooks.js                     # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ - webhook endpoints
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ Dockerfile.integrations             # Docker image Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
â””â”€â”€ docker-compose.server.yml               # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ integrations service
```

### ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

- `/backend/src/api/webhooks.js` - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ endpoints Ğ´Ğ»Ñ Fixly Ğ¸ Offerteo
- `/docker-compose.server.yml` - Ğ·Ğ°Ğ¼ĞµĞ½ĞµĞ½ telegram-bot Ğ½Ğ° integrations

## ğŸ”§ ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### 1. Unified Integration Manager

**Ğ¤Ğ°Ğ¹Ğ»:** `/backend/src/integrations/unified-integration-manager.js`

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
- Telegram Bot Ñ Ğ¼ĞµĞ½Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° callback queries
- Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ°ÑĞ²ĞºĞ°Ñ… (Fixly, Offerteo)
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Retell AI
- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¸ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹

**ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Telegram:**
- `/start` - Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ
- `/help` - Ğ¡Ğ¿Ñ€Ğ°Ğ²ĞºĞ°
- `/ping` - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞ²ÑĞ·Ğ¸
- `/id` - ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Chat ID
- `/leads` - Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ»Ğ¸Ğ´Ğ¾Ğ²
- `/stats` - Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° CRM

**ĞœĞµĞ½Ñ:**
- ğŸ“ CRM - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ (Ğ»Ğ¸Ğ´Ñ‹, Ğ·Ğ²Ğ¾Ğ½ĞºĞ¸, ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°)
- ğŸ—ï¸ Fixly - Ğ—Ğ°ÑĞ²ĞºĞ¸ (Ğ¾Ğ¶Ğ¸Ğ´Ğ°ÑÑ‰Ğ¸Ğµ, Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚Ñ‹Ğµ)
- ğŸ—ï¸ Offerteo - Ğ¢ĞµĞ½Ğ´ĞµÑ€Ñ‹ (Ğ½Ğ¾Ğ²Ñ‹Ğµ, Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ)
- ğŸ¤– Retell - AI Ğ—Ğ²Ğ¾Ğ½ĞºĞ¸ (ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ, Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ)

### 2. Webhook Endpoints

**Ğ¤Ğ°Ğ¹Ğ»:** `/backend/src/api/webhooks.js`

**Endpoints:**

```
POST /api/webhooks/fixly
```
ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ·Ğ°ÑĞ²ĞºĞ¸ Ğ¾Ñ‚ Fixly bot:
- Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ»Ğ¸Ğ´Ğ° Ğ² CRM
- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Telegram
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ leadId

```
POST /api/webhooks/offerteo
```
ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ‚ĞµĞ½Ğ´ĞµÑ€Ñ‹ Ğ¾Ñ‚ Offerteo bot:
- Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ»Ğ¸Ğ´Ğ° Ğ² CRM  
- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Telegram
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ leadId

```
POST /api/webhooks/retell
```
ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¾Ñ‚ Retell AI:
- ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ·Ğ²Ğ¾Ğ½ĞºĞ°
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ

```
GET /api/webhooks/test
```
Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ endpoint Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸

## ğŸ³ Docker Setup

### Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°

```bash
cd /root/pbk-crm-unified
docker build -f docker/Dockerfile.integrations -t pbk-integrations:latest .
```

### Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°

```bash
docker-compose -f docker-compose.server.yml up -d integrations
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ²

```bash
docker logs pbk-integrations --tail 50 -f
```

### ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

```env
NODE_ENV=production
TELEGRAM_BOT_TOKEN=8003573668:AAHHs6GUJx-pUEL-fxe_lwVJCRutftrCZ30
TELEGRAM_OWNER_CHAT_ID=443876287
TELEGRAM_APPROVAL_GROUP=-5088238645
CRM_API_URL=http://backend:5002/api
BASE_URL=https://appp2p-01.tail96f20b.ts.net
RETELL_API_KEY=<your_key>
RETELL_AGENT_ID=<your_agent_id>
RETELL_PHONE_NUMBER=<your_number>
OFFERTEO_API_KEY=<your_key>
```

## ğŸ”— Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

### Fixly.pl

**Bot location:** `/opt/fixly-automation/`
**Service:** `fixly-bot.service` (systemd)

**ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° webhook:**

Ğ’ Fixly bot Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² CRM:

```javascript
// Ğ’ /opt/fixly-automation/scripts/fixly-bot.js
// ĞŸĞ¾ÑĞ»Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ÑĞ´ĞµĞ»ĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² CRM:

const webhookUrl = 'http://localhost:5002/api/webhooks/fixly';
const leadData = {
  fixlyId: orderId,
  title: orderTitle,
  customerName: customerName,
  phone: phoneNumber,
  email: email,
  description: description,
  district: district,
  budget: budget
};

await axios.post(webhookUrl, leadData);
```

### Offerteo.pl

**Bot location:** `/root/offerteo-bot/`
**Main file:** `offerteo-hybrid-bot.js`

**ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° webhook:**

```javascript
// Ğ’ /root/offerteo-bot/offerteo-hybrid-bot.js
// ĞŸĞ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ·Ğ°ÑĞ²ĞºĞ¸:

const webhookUrl = 'http://localhost:5002/api/webhooks/offerteo';
const leadData = {
  rfpId: rfp.id,
  title: rfp.title,
  description: rfp.description,
  categoryName: rfp.categoryName,
  locationName: rfp.locationName,
  budget: rfp.budget,
  deadline: rfp.deadline
};

await axios.post(webhookUrl, leadData);
```

### Retell AI

**API endpoints:** `/api/retell/*`

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

```javascript
// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ·Ğ²Ğ¾Ğ½Ğ¾Ğº
POST /api/retell/call
{
  "lead_id": "uuid",
  "phone_number": "+48123456789",
  "ai_instructions": "Ğ£Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ±ÑĞ´Ğ¶ĞµÑ‚ Ğ¸ Ñ€Ğ°Ğ¹Ğ¾Ğ½"
}

// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ
GET /api/retell/call/:call_id

// Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ·Ğ²Ğ¾Ğ½ĞºĞ¾Ğ²
GET /api/retell/calls
```

## âš ï¸ Ğ˜Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

### Telegram Bot - 409 Conflict Error

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ±Ğ¾Ñ‚Ğ¾Ğ² Ğ¿Ñ‹Ñ‚Ğ°ÑÑ‚ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½ Ñ‚Ğ¾ĞºĞµĞ½ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾.

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:**
- ĞĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ Telegram Ğ±Ğ¾Ñ‚Ğ¾Ğ² Ñ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¼ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ¼
- Systemd ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°ÑÑ‚ Ğ±Ğ¾Ñ‚Ğ¾Ğ²

**ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:**
- `fixly-bot.service` - Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½
- `pumpmaster-bot.service` - Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½
- `p2p-subscription-bot.service` - Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½  
- `twa-bot.service` - Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½
- `voiceover-bot.service` - Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¸ Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ 1: ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒ**
Telegram API Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑƒĞ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ±Ğ¾Ñ‚Ğ°.

```bash
# ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ telegram Ğ±Ğ¾Ñ‚Ñ‹
systemctl stop fixly-bot pumpmaster-bot p2p-subscription-bot twa-bot voiceover-bot

# ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒ 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹
sleep 120

# ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ integrations
docker restart pbk-integrations
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ 2: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ webhook Ğ²Ğ¼ĞµÑÑ‚Ğ¾ polling**

Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ² `unified-integration-manager.js`:

```javascript
// Ğ’Ğ¼ĞµÑÑ‚Ğ¾ polling
const bot = new TelegramBot(CONFIG.telegram.token, { polling: true });

// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ webhook
const bot = new TelegramBot(CONFIG.telegram.token, { webHook: true });
bot.setWebHook(`${CONFIG.crm.baseUrl}/telegram-webhook/${CONFIG.telegram.token}`);
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ 3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½**

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· @BotFather ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ PBK CRM.

## ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²

```bash
docker ps --filter "name=pbk" --format "table {{.Names}}\t{{.Status}}"
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ²

```bash
# Integration Manager
docker logs pbk-integrations --tail 100 -f

# Backend
docker logs pbk-backend --tail 100 -f

# Database
docker logs pbk-postgres --tail 100
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Telegram Bot

```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ webhook
curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo" | jq .

# ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
curl -X POST "https://api.telegram.org/bot<TOKEN>/sendMessage" \
  -d "chat_id=443876287" \
  -d "text=Test"
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° webhook endpoints

```bash
# Test endpoint
curl http://localhost:5002/api/webhooks/test | jq .

# Test Fixly webhook
curl -X POST http://localhost:5002/api/webhooks/fixly \
  -H "Content-Type: application/json" \
  -d '{
    "fixlyId": "test123",
    "title": "Test order",
    "customerName": "Test Customer",
    "phone": "+48123456789"
  }' | jq .
```

## ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ² Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞ½

### 1. ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ÑƒÑÑ‰Ğ¸Ğµ Ğ±Ğ¾Ñ‚Ñ‹

```bash
systemctl stop fixly-bot pumpmaster-bot p2p-subscription-bot twa-bot voiceover-bot
systemctl disable pumpmaster-bot p2p-subscription-bot twa-bot voiceover-bot
pkill -9 -f telegram
pkill -9 -f bot.py
```

### 2. ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ°Ñ‚ÑŒ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Telegram API

```bash
sleep 120
```

### 3. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Unified Integration Manager

```bash
cd /root/pbk-crm-unified
docker-compose -f docker-compose.server.yml up -d integrations
```

### 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸

```bash
docker logs pbk-integrations --tail 50 -f
```

### 5. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ

ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ `/start` Ğ±Ğ¾Ñ‚Ñƒ @Pbkauto_bot Ğ² Telegram

### 6. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Fixly bot

ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Fixly bot Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ webhook Ğ² CRM Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ÑĞ´ĞµĞ»ĞºĞ¸.

### 7. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Offerteo bot

Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Offerteo bot Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ webhook Ğ² CRM.

### 8. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Fixly bot

```bash
systemctl start fixly-bot
```

## ğŸ“ TODO

- [ ] Ğ ĞµÑˆĞ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ 409 Conflict Ñ Telegram Bot
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ webhook Ğ¾Ñ‚ Fixly bot Ğº CRM
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ webhook Ğ¾Ñ‚ Offerteo bot Ğº CRM
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Retell AI Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¸ retry logic
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ dashboard Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹

## ğŸ†˜ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°

ĞŸÑ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°Ñ…:

1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Telegram Bot Ñ‡ĞµÑ€ĞµĞ· API
3. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ğ¾ Ğ½ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ÑƒÑÑ‰Ğ¸Ñ… Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ²
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

---

**Ğ”Ğ°Ñ‚Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ:** 2026-01-06  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0  
**ĞĞ²Ñ‚Ğ¾Ñ€:** OpenCode AI Assistant

# OpenAI Integration Setup - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

## –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

AI Assistant —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **OpenAI –∫–∞–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä**:

1. **OpenAI** - –ü–µ—Ä–≤—ã–π –≤—ã–±–æ—Ä (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
2. **OpenRouter** - Fallback (–µ—Å–ª–∏ OpenAI –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

## –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ OpenAI

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://platform.openai.com/api-keys
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á (Secret Key)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-`)

### –®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ –≤ .env

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `/root/pbk-crm-unified/.env` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:

```env
# –ë–´–õ–û:
OPENAI_API_KEY=sk-placeholder

# –°–¢–ê–õ–û:
OPENAI_API_KEY=sk-–≤–∞—à-–Ω–∞—Å—Ç–æ—è—â–∏–π-–∫–ª—é—á-–æ—Ç-openai
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–¥–µ–ª—å:

```env
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏
OPENAI_MODEL=gpt-4-turbo-preview    # –°–∞–º–∞—è –º–æ—â–Ω–∞—è (–¥–æ—Ä–æ–∂–µ)
OPENAI_MODEL=gpt-4                  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è GPT-4
OPENAI_MODEL=gpt-3.5-turbo          # –ë—ã—Å—Ç—Ä–∞—è –∏ –¥–µ—à–µ–≤–∞—è
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É

```bash
cd /root/pbk-crm-unified/backend
node tests/check-ai-status.js
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:

```
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  AI Integration Status Check
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚úÖ Found .env file: /root/pbk-crm-unified/.env

ü§ñ OpenAI Configuration:
   ‚úÖ API Key: sk-...
   ‚úÖ Model: gpt-4-turbo-preview
   ‚úÖ Status: Configured

üì¶ OpenRouter Configuration:
   ‚úÖ API Key: sk-or-v1-...
   ‚úÖ Status: Configured (fallback)

‚úÖ AI Integration is CONFIGURED and READY!
   ‚Ä¢ Using OpenAI (recommended)
   ‚Ä¢ Using OpenRouter as fallback
```

### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

```bash
cd /root/pbk-crm-unified/backend
node tests/test-ai-integration.js
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚úÖ OpenAI: OK
   Response: "OpenAI works!"
   Tokens used: 15
```

## –°—Ç–æ–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OpenAI

### –¶–µ–Ω—ã (–Ω–∞ —è–Ω–≤–∞—Ä—å 2026)

**GPT-4 Turbo:**
- Input: $10 / 1M tokens
- Output: $30 / 1M tokens
- ~$0.03 –∑–∞ –∑–∞–ø—Ä–æ—Å (—Å—Ä–µ–¥–Ω–µ–µ)

**GPT-3.5 Turbo:**
- Input: $0.50 / 1M tokens
- Output: $1.50 / 1M tokens  
- ~$0.002 –∑–∞ –∑–∞–ø—Ä–æ—Å (—Å—Ä–µ–¥–Ω–µ–µ)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —ç–∫–æ–Ω–æ–º–∏–∏

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `gpt-3.5-turbo` –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á
2. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ `max_tokens` (—Å–µ–π—á–∞—Å 800)
3. –ö–µ—à–∏—Ä—É–π—Ç–µ —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã
4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ https://platform.openai.com/usage

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ OpenAI vs OpenRouter

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | OpenAI | OpenRouter |
|---|---|---|
| **–ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–æ | ‚≠ê‚≠ê‚≠ê‚≠ê –•–æ—Ä–æ—à–æ |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚ö° –ë—ã—Å—Ç—Ä–æ | ‚ö° –°—Ä–µ–¥–Ω–µ |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | üí∞ –ü–ª–∞—Ç–Ω–æ | üÜì –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚úÖ –°—Ä–µ–¥–Ω—è—è |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** | ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è | ‚ö†Ô∏è –°–æ–æ–±—â–µ—Å—Ç–≤–æ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OpenAI –¥–ª—è production, OpenRouter –¥–ª—è —Ç–µ—Å—Ç–æ–≤.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ API

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend

```bash
cd /root/pbk-crm-unified/backend
npm start
```

### 2. –¢–µ—Å—Ç —á–µ—Ä–µ–∑ curl (—Ç—Ä–µ–±—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω)

```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ /api/auth/login

# –¢–µ—Å—Ç AI Copilot
curl -X POST http://localhost:5000/api/ai/copilot \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–ü—Ä–∏–≤–µ—Ç! –ü–æ–∫–∞–∂–∏ –≤—Å–µ –ª–∏–¥—ã"
  }'
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:

```json
{
  "success": true,
  "message": "–í–æ—Ç —Å–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ...",
  "provider": "openai",
  "model": "gpt-4-turbo-preview",
  "usage": {
    "prompt_tokens": 120,
    "completion_tokens": 85,
    "total_tokens": 205
  },
  "action": {
    "type": "showLeads",
    "data": [...]
  }
}
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: `"provider": "openai"` - –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è OpenAI!

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid API key"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∫–ª—é—á OpenAI

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-` (–Ω–µ `sk-placeholder`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–ª—é—á –Ω–µ –∏—Å—Ç–µ–∫ –Ω–∞ https://platform.openai.com/api-keys
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`

### –ü—Ä–æ–±–ª–µ–º–∞: "Insufficient quota"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ OpenAI

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://platform.openai.com/account/billing
2. –î–æ–±–∞–≤—å—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–π –º–µ—Ç–æ–¥
3. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å ($5-10 –¥–ª—è —Å—Ç–∞—Ä—Ç–∞)
4. –ò–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ OpenRouter (fallback)

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenRouter

**–ü—Ä–∏—á–∏–Ω–∞:** `.env` —Ñ–∞–π–ª –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env`: `grep OPENAI_API_KEY /root/pbk-crm-unified/.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ `sk-placeholder`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend: `npm restart`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: Rate limit exceeded

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É
2. –£–≤–µ–ª–∏—á—å—Ç–µ tier –Ω–∞ https://platform.openai.com/account/limits
3. –î–æ–±–∞–≤—å—Ç–µ retry –ª–æ–≥–∏–∫—É –≤ –∫–æ–¥
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OpenRouter –∫–∞–∫ fallback

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤

1. Dashboard: https://platform.openai.com/usage
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–∏–º–∏—Ç—ã —Ä–∞—Å—Ö–æ–¥–æ–≤
3. –í–∫–ª—é—á–∏—Ç–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CRM

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- Provider (openai/openrouter)
- Model
- Tokens used
- Response time

–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏: `tail -f /root/pbk-crm-unified/backend/logs/ai.log`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- API –∫–ª—é—á –≤ `.env` (–Ω–µ –≤ –∫–æ–¥–µ)
- `.env` –≤ `.gitignore`
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

‚ö†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –†–æ—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –∫–∞–∂–¥—ã–µ 3 –º–µ—Å—è—Ü–∞
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è dev/prod
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ IP –∞–¥—Ä–µ—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ò—Ç–æ–≥–æ

–ü–æ—Å–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OpenAI:

‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–¥–∞–µ—Ç—Å—è OpenAI  
‚úÖ OpenRouter –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç  
‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ —É–ª—É—á—à–∞–µ—Ç—Å—è  
‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ Production ready  

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å OpenAI –∏ –Ω–∞—á–∏–Ω–∞–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å!
